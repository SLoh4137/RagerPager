<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <script type="text/javascript">
    var host = "ragerpager.me";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
</script>
    <title>Rager Pager</title>
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCypaO-SNej-CU5zD0m3jIMdvMuiJqZat0&callback=initMap">
    </script>

    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="firebaseAuth.js"></script>
<script>

var map;
var pos;

initMap();

function initMap() {

  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 0, lng: 0},
    zoom: 18,
    zoomControl: true,
    zoomControlOptions: {
        position: google.maps.ControlPosition.TOP_RIGHT
    },
    streetViewControl: false,
  });

  var infoWindow = new google.maps.InfoWindow({map: map});

  // Try HTML5 geolocation.
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      infoWindow.setPosition(pos);
      infoWindow.setContent('Location found.');
      map.setCenter(pos);

    }, function() {
      handleLocationError(true, infoWindow, map.getCenter());
    });
  } else {
    // Browser doesn't support Geolocation
    handleLocationError(false, infoWindow, map.getCenter());
  }

}

function handleLocationError(browserHasGeolocation, infoWindow, pos) {
  infoWindow.setPosition(pos);
  infoWindow.setContent(browserHasGeolocation ?
                        'Error: The Geolocation service failed.' :
                        'Error: Your browser doesn\'t support geolocation.');
}

var marker;
function createMarker(map, pos) {
	
	var fire = 'images/Fire.png';
  marker = new google.maps.Marker({
    position: pos,
    map: map,
	animation: google.maps.Animation.DROP,
    title: 'It\'s Lit!',
	icon: fire,
  });
  marker.addListener('click', toggleBounce);

}

function toggleBounce() {
  if (marker.getAnimation() !== null) {
    marker.setAnimation(null);
  } else {
    marker.setAnimation(google.maps.Animation.BOUNCE);
  }
  $("#responses").modal();
}

function buttonClick() {
	document.getElementById('comment').placeholder = 'Type comment here.';
	document.getElementById('comment').value = '';
	console.log('click');
    addToFirebase(pos);
    window.alert("button clicked");
}

</script>

    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        justify-content: center;
      }

      .front_panel {
      	position:fixed;
      	left: 50%;
		transform: translateX(-50%);
		bottom:5%;
      	width:96%;
      	z-index:2;
      }

      #comment {
      	outline-width: 0;
      	border:none;
      }

      #submit_button {
      	width=200px;
      	right:5px;
      }

    </style>

  </head>

  <body>

  	<div class="front_panel"><button type="button" class="btn-primary btn-block btn btn-lg" data-toggle="modal" data-target="#myModal" onClick="buttonClick()"> It's Lit!</button></div>

  	<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">How Lit?!</h4>
        </div>
        <div class="modal-body">
          <input type="text" id="comment">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="createMarker(map,pos)">Submit</button>
        </div>
      </div>
    </div>
  	</div>

  	<div class="modal fade" id="responses" role="dialog">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Check-ins</h4>
        </div>
        <div class="modal-body">
          Insert check-ins from Firebase here.
        </div>
      </div>
    </div>
  	</div>

    <div id="map"></div>
	
  </body>
</html>
